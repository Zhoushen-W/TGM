2025/12/11：
train脚本跑通，但是训练出来模型报废
	经测试可以排除样本数量原因


2025/12/12：
检查训练集时发现问题，按原本的生成方法，当样本经过多次变换后，prob有时无法正确覆盖无图像区域
	可能是因为图像部分区域在第一次变换后处于区域之外，第二次变换后超出部分已经无效，仅通过M_AtoB无法完全构造prob
	考虑每一步变换都更新prob？目前通过限定一次变换暂时规避该问题，后续还要注意变换尺度刚好等于1（相当于没变）的情况

检查变换函数warp时发现问题，归一化网格右乘M后将不再是归一化坐标系，与Loss中调用时语义不一致
	在test_warp函数绘制x2时发现整张图都是黑色的，不符合预期
	对warp函数进行修改
	通过构造pixel -> norm，在像素坐标完成变换再归一化，解决问题，在最大尺度下测试结果正常


2025/12/13：
检查变换函数warp时又发现问题，变换矩阵M_AtoB是在最大尺度下定义的，直接作用于小尺度是不合法的
	通过仿射变换得到各个尺度下的M_AtoB，再进行Loss。解决问题，训练成功！

训练出来的模型在处理旋转、缩放变换时还行，但是对于之前的w/2步长分割的图片很差，训练集需要调整难度


2025/12/14：
高斯过程的维度问题，RoMa的高斯过程维度是与粗特征维度c相同
	测试一下让高斯过程也是320维，提升不明显


2025/12/15：
评估模型时发现问题，现在的训练集生成方式中，im_B中的所有像素都在im_A中，这是不合理的！训练集不仅需要变换，还需要其余部分的像素
	构建数据集的方式需要修改。在大图中，先找出n个im_A，再生成M_AtoB，再变换im_A取得im_B，对im_A与im_B求交集得到prob？
	可以对大图做逆变换，在变换前后相同位置取得im_A和im_B。
	所谓缩放，缩放的是im_A边框的大小，放大了，框进来的像素也就多了，原本的区域就变小了
	解决方案：patch大小为512的图像中固定一个256的采样窗口，对大图做M_full变换，变换前后采样得到im_A和im_B，再对M_full仿射得到M_AtoB


2025/12/16：
在计算代价函数warp的时候，缩放情况下的warp坐标对应好像不对，检查一下
	好像是对的


2025/12/17：
使用现在的高挑战性训练集的训练结果非常诡异，误匹配相当多
	在RobusLoss中改了两处，p < 1 / 256
	现在知道了，这个是归一化坐标系到full-res的变换，表示像素是否在归一化坐标系内，改回去了


2025/12/19：
直接检查corrresps的finest-flow的时候发现问题很大
	chat-gpt：从真值生成x2的方法不对，应该对full-res下的进行下采样，而不是重新生成
	验证发现误差很小，对训练应该没有影响，但考虑计算量还是可以改写一下（非本质问题）

Loss设计应该是不适合的
	先把Loss替换成l2，对某一个epe估计较大的数据进行过拟合训练，观察是否会下降
	完全不对


2025/12/20：
GT标签的问题，可能失效
	还是改用full-res采样生成每一个scale下的warp试一下
	好像没啥区别

发现GT原本设定的是64*64的大小，并且只在粗特征上进行。但是现在的数据集1 / 8特征分辨率只有32
	把Transformer从分类器改成了回归器，直接预测flow，然后算reg_loss_coarse和reg_loss_fine
	后续还需要做实验验证一下不管certainty，粗特征还是分类，这种情况下能不能行


2025/12/21：
发现改成回归器之后，纯用鲁棒回归代价函数导致x2坍缩到边界上

prob的构造需要重置，因为算loss的时候要求epe和prob是对齐的，现在是在A、B中，没对齐
	修正了prob，增加一个prob_A，并减小难度
	成功了！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！
	下一步考虑：如何恢复certainty，加难度


2026/1/7：
为地形场设计了专用的置信度（高程熵），训练效果得到提升，与RoMa对比之后发现效果很好！
	下一步：可以考虑重力场了


2026/1/8：
把warp下采样时的方式从nearest改成了bilinear（warp.py）


2026/1/15：
仿真时遇到问题。人工比对的匹配图像，验证发现可以匹配并且置信度点数量还行，但是会出现很强的误匹配（疑似缩放问题）
	尝试弱化缩放，再选一部分图像重新归一化和加噪声